<section class="sale-banner">
        <img src="https://nakshatrajewels.in/cdn/shop/files/s8.png?v=1720001073&width=3840" alt="Sale Banner" class="sale-banner-img">
        <div class="sale-banner-content">
            <h1 class="hero-title">Our Collections</h1>
            <p class="hero-subtitle">Discover timeless elegance in every piece</p>
        </div>
    </section>

    <!-- Filter Section -->
    <div class="filter-section">
        <button class="filter-btn active" data-filter="all">All Products</button>
        <button class="filter-btn" data-filter="Earrings">Earrings</button>
        <button class="filter-btn" data-filter="Rings">Rings</button>
        <button class="filter-btn" data-filter="Necklaces">Necklaces</button>
        <button class="filter-btn" data-filter="Bracelets">Bracelets</button>
    </div>

    <!-- New Arrivals Section -->
    <section class="product-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">New Arrivals</h2>
            </div>
            <div class="products-grid">
                <% if (newArrivals && newArrivals.length > 0) { %>
                    <% newArrivals.forEach(product => { %>
                        <a href="/product/<%= product._id %>" class="product-card" data-category="<%= product.category %>" data-id="<%= product._id %>">
                            <div class="product-image" style="background-image: url('<%= product.images[0].url || product.images[0] %>');"></div>
                            <div class="product-info">
                                <div class="product-name"><%= product.name %></div>
                                <div class="product-actions">
                                    <div class="product-price">₹<%= product.price.toLocaleString('en-IN') %></div>
                                    <div class="action-icons">
                                        <div class="action-icon wishlist-icon" data-id="<%= product._id %>" data-name="<%= product.name %>" title="Add to Wishlist">♡</div>
                                        <div class="action-icon cart-icon" data-id="<%= product._id %>" data-name="<%= product.name %>" title="Add to Cart">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="9" cy="21" r="1"></circle>
                                                <circle cx="20" cy="21" r="1"></circle>
                                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    <% }); %>
                <% } else { %>
                    <p style="color: #ccc; text-align: center; grid-column: 1 / -1; padding: 40px 0;">No new arrivals available.</p>
                <% } %>
            </div>
        </div>
    </section>

    <!-- Most Gifted Section -->
    <section class="product-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Most Gifted</h2>
            </div>
            <div class="products-grid">
                <% if (mostGifted && mostGifted.length > 0) { %>
                    <% mostGifted.forEach(product => { %>
                        <a href="/product/<%= product._id %>" class="product-card" data-category="<%= product.category %>" data-id="<%= product._id %>">
                            <div class="product-image" style="background-image: url('<%= product.images[0].url || product.images[0] %>');"></div>
                            <div class="product-info">
                                <div class="product-name"><%= product.name %></div>
                                <div class="product-actions">
                                    <div class="product-price">₹<%= product.price.toLocaleString('en-IN') %></div>
                                    <div class="action-icons">
                                        <div class="action-icon wishlist-icon" data-id="<%= product._id %>" data-name="<%= product.name %>" title="Add to Wishlist">♡</div>
                                        <div class="action-icon cart-icon" data-id="<%= product._id %>" data-name="<%= product.name %>" title="Add to Cart">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="9" cy="21" r="1"></circle>
                                                <circle cx="20" cy="21" r="1"></circle>
                                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    <% }); %>
                <% } else { %>
                    <p style="color: #ccc; text-align: center; grid-column: 1 / -1; padding: 40px 0;">No most gifted products available.</p>
                <% } %>
            </div>
        </div>
    </section>

    <!-- Recommended for You Section -->
    <section class="product-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Recommended for You</h2>
            </div>
            <div class="products-grid">
                <% if (recommended && recommended.length > 0) { %>
                    <% recommended.forEach(product => { %>
                        <a href="/product/<%= product._id %>" class="product-card" data-category="<%= product.category %>" data-id="<%= product._id %>">
                            <div class="product-image" style="background-image: url('<%= product.images[0].url || product.images[0] %>');"></div>
                            <div class="product-info">
                                <div class="product-name"><%= product.name %></div>
                                <div class="product-actions">
                                    <div class="product-price">₹<%= product.price.toLocaleString('en-IN') %></div>
                                    <div class="action-icons">
                                        <div class="action-icon wishlist-icon" data-id="<%= product._id %>" data-name="<%= product.name %>" title="Add to Wishlist">♡</div>
                                        <div class="action-icon cart-icon" data-id="<%= product._id %>" data-name="<%= product.name %>" title="Add to Cart">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="9" cy="21" r="1"></circle>
                                                <circle cx="20" cy="21" r="1"></circle>
                                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    <% }); %>
                <% } else { %>
                    <p style="color: #ccc; text-align: center; grid-column: 1 / -1; padding: 40px 0;">No recommended products available.</p>
                <% } %>
            </div>
        </div>
    </section>

    <script>
        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', () => {
                // Update active button
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const category = button.getAttribute('data-filter');
                const allCards = document.querySelectorAll('.product-card');
                
                allCards.forEach(card => {
                    const productCategory = card.getAttribute('data-category');
                    if (category === 'all' || productCategory === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });

        // Wishlist functionality
        document.querySelectorAll('.wishlist-icon').forEach(icon => {
            icon.addEventListener('click', async (e) => {
                e.preventDefault();
                e.stopPropagation();
                const productId = icon.getAttribute('data-id');
                const productName = icon.getAttribute('data-name');
                
                try {
                    const response = await fetch('/api/wishlist/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ productId })
                    });
                    
                    if (response.ok) {
                        showNotification(`${productName} added to wishlist!`);
                        icon.style.color = '#FF0000';
                    }
                } catch (error) {
                    console.error('Error adding to wishlist:', error);
                }
            });
        });

        // Cart functionality
        document.querySelectorAll('.cart-icon').forEach(icon => {
            icon.addEventListener('click', async (e) => {
                e.preventDefault();
                e.stopPropagation();
                const productId = icon.getAttribute('data-id');
                const productName = icon.getAttribute('data-name');
                
                try {
                    const response = await fetch('/api/cart/add', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ productId, quantity: 1 })
                    });
                    
                    if (response.ok) {
                        showNotification(`${productName} added to cart!`);
                    }
                } catch (error) {
                    console.error('Error adding to cart:', error);
                }
            });
        });

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = 'position: fixed; top: 80px; right: 20px; background: #D4AF37; color: #000; padding: 15px 25px; border-radius: 10px; font-weight: 600; z-index: 10001; animation: slideIn 0.3s ease;';
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }
    </script>