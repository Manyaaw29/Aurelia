<!-- Sale Banner with Text -->
<section class="sale-banner">
  <img src="https://nakshatrajewels.in/cdn/shop/files/s8.png?v=1720001073&width=3840" alt="Sale Banner" class="sale-banner-img">

  <div class="sale-banner-content">
    <h1 class="hero-title">Our Collections</h1>
    <p class="hero-subtitle">Discover timeless elegance in every piece</p>
  </div>
</section>

<!-- Main Products Section - First 8 Products -->
<section class="product-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title"><%= categoryName %></h2>
    </div>
    
    <div class="products-grid">
      <% if (products && products.length > 0) { %>
        <% products.slice(0, 8).forEach(product => { %>
          <a href="/product/<%= product._id %>" class="product-card-link" aria-label="View <%= product.name %>">
            <div class="product-card">
              <div class="product-image" style="background-image: url('<%= product.images[0].url || product.images[0] %>');"></div>
              <div class="product-info">
                <div class="product-name"><%= product.name %></div>
                <div class="product-actions">
                  <div class="product-price">₹<%= product.price.toLocaleString('en-IN') %></div>
                  <div class="action-icons">
                    <div class="action-icon wishlist-btn" data-id="<%= product._id %>" data-name="<%= product.name %>" onclick="event.preventDefault(); addToWishlistFromListing(this)">♡</div>
                    <div class="action-icon cart-btn" data-id="<%= product._id %>" data-name="<%= product.name %>" onclick="event.preventDefault(); addToCartFromListing(this)">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </a>
        <% }); %>
      <% } else { %>
        <p style="color: #ccc; text-align: center; grid-column: 1 / -1; padding: 40px 0;">No products available in this category.</p>
      <% } %>
    </div>
  </div>
</section>

<!-- Most Gifted Section - Next 4 Products -->
<% if (giftedProducts && giftedProducts.length > 0) { %>
  <section class="product-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Most Gifted</h2>
      </div>
      
      <div class="products-grid">
        <% giftedProducts.forEach(product => { %>
          <a href="/product/<%= product._id %>" class="product-card-link" aria-label="View <%= product.name %>">
            <div class="product-card">
              <div class="product-image" style="background-image: url('<%= product.images[0].url || product.images[0] %>');"></div>
              <div class="product-info">
                <div class="product-name"><%= product.name %></div>
                <div class="product-actions">
                  <div class="product-price">₹<%= product.price.toLocaleString('en-IN') %></div>
                  <div class="action-icons">
                    <div class="action-icon wishlist-btn" data-id="<%= product._id %>" data-name="<%= product.name %>" onclick="event.preventDefault(); addToWishlistFromListing(this)">♡</div>
                    <div class="action-icon cart-btn" data-id="<%= product._id %>" data-name="<%= product.name %>" onclick="event.preventDefault(); addToCartFromListing(this)">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </a>
        <% }); %>
      </div>
    </div>
  </section>
<% } %>

<script>
  async function addToWishlistFromListing(element) {
    const productId = element.dataset.id;
    const productName = element.dataset.name;
    
    try {
      const response = await fetch('/api/wishlist/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId })
      });
      
      if (response.ok) {
        showNotification(`${productName} added to wishlist!`);
        element.style.color = '#D4AF37';
      }
    } catch (error) {
      console.error('Error adding to wishlist:', error);
    }
  }

  async function addToCartFromListing(element) {
    const productId = element.dataset.id;
    const productName = element.dataset.name;
    
    try {
      const response = await fetch('/api/cart/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId, quantity: 1 })
      });
      
      if (response.ok) {
        showNotification(`${productName} added to cart!`);
      }
    } catch (error) {
      console.error('Error adding to cart:', error);
    }
  }

  function showNotification(message) {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = 'position: fixed; top: 100px; right: 20px; background: #D4AF37; color: #000; padding: 15px 25px; border-radius: 10px; font-weight: 600; z-index: 10001; animation: slideIn 0.3s ease;';
    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 2000);
  }
</script>
